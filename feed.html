<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KLIKSY Feed</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="auth.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #0a0e27 0%, #1a0b2e 50%, #160b28 100%);
      min-height: 100vh;
      width: 100vw;
      overflow-x: hidden;
      position: relative;
      color: #FFFFFF;
    }

    /* Animated gradient orbs */
    .orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(100px);
      opacity: 0.5;
      animation: float 15s ease-in-out infinite;
      z-index: 0;
    }

    .orb1 {
      width: 600px;
      height: 600px;
      background: radial-gradient(circle, #FF6B6B 0%, transparent 70%);
      top: -150px;
      right: -150px;
      animation-delay: 0s;
    }

    .orb2 {
      width: 500px;
      height: 500px;
      background: radial-gradient(circle, #4ECDC4 0%, transparent 70%);
      bottom: 100px;
      left: -200px;
      animation-delay: 5s;
    }

    .orb3 {
      width: 450px;
      height: 450px;
      background: radial-gradient(circle, #FFE66D 0%, transparent 70%);
      top: 40%;
      right: 15%;
      animation-delay: 10s;
    }

    @keyframes float {

      0%,
      100% {
        transform: translate(0, 0) scale(1);
      }

      33% {
        transform: translate(40px, -60px) scale(1.15);
      }

      66% {
        transform: translate(-30px, 40px) scale(0.85);
      }
    }

    /* Logo */
    .logo {
      position: relative;
      display: flex;
      gap: 4px;
      font-size: 36px;
      font-weight: 900;
      letter-spacing: 0.05em;
      z-index: 10;
      color: #FFFFFF;
      text-transform: uppercase;
    }

    .logo-dot {
      color: #FF6B6B;
    }

    /* Navigation */
    nav {
      position: sticky;
      top: 0;
      z-index: 100;
      background: #0a0e27;
      padding: 16px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px solid rgba(255, 107, 107, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .nav-links a {
      font-weight: 700;
      color: rgba(255, 255, 255, 0.7);
      padding: 10px 20px;
      border-radius: 12px;
      transition: all 0.3s ease;
      font-size: 15px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      text-decoration: none;
    }

    .nav-links a.active {
      color: #FFFFFF;
      background: linear-gradient(135deg, rgba(255, 107, 107, 0.3) 0%, rgba(78, 205, 196, 0.3) 100%);
    }

    .nav-links a:hover {
      color: #FFFFFF;
      background: rgba(255, 107, 107, 0.2);
    }

    /* Logout button */
    .logout-btn {
      background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
      padding: 10px 24px;
      border-radius: 12px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      border: none;
      color: white;
      cursor: pointer;
      text-transform: uppercase;
      font-size: 13px;
      letter-spacing: 0.05em;
    }

    main {
      position: relative;
      z-index: 5;
      padding-top: 60px;
      padding-bottom: 80px;
      max-width: 1400px;
      margin: 0 auto;
      padding-left: 32px;
      padding-right: 32px;
    }

    /* Feed Hero */
    .feed-hero {
      font-size: 72px;
      font-weight: 900;
      line-height: 1;
      color: #FFFFFF;
      margin-bottom: 12px;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: -0.02em;
    }

    p.subtitle {
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 48px;
      text-align: center;
      font-size: 20px;
      font-weight: 600;
    }

    /* Meme cards */
    .meme-card {
      background: linear-gradient(135deg, #1a0b2e 0%, #0f0520 100%);
      color: #FFFFFF;
      border-radius: 20px;
      overflow: hidden;
      border: 2px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      position: relative;
    }

    .meme-card:hover {
      border-color: rgba(255, 107, 107, 0.5);
    }

    .meme-card img {
      width: 100%;
      height: 300px;
      object-fit: contain;
      position: relative;
      z-index: 1;
      background: rgba(0, 0, 0, 0.3);
    }

    .meme-card .info {
      padding: 16px;
      position: relative;
      z-index: 1;
    }

    .meme-card .user {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }

    .meme-card .avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      font-weight: 700;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 100%);
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
      color: white;
    }

    .meme-card .user span {
      font-weight: 600;
      color: #FFFFFF;
      font-size: 14px;
    }

    .meme-card .description {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.9);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .meme-card .meta-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: rgba(255, 255, 255, 0.65);
      letter-spacing: 0.02em;
    }

    .meme-card .timestamp {
      font-size: 11px;
      color: rgba(255, 255, 255, 0.7);
      margin-left: auto;
      font-weight: 600;
      letter-spacing: 0.05em;
    }

    /* Load more button */
    .load-more {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      background: linear-gradient(135deg, #FF6B6B 0%, #FFE66D 100%);
      padding: 16px 40px;
      border-radius: 50px;
      font-weight: 800;
      margin-top: 60px;
      transition: all 0.3s ease;
      border: none;
      color: #0a0e27;
      cursor: pointer;
      font-size: 16px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .load-more:hover {
      transform: translateY(-3px);
    }

    .status-message {
      margin: 24px auto 16px;
      text-align: center;
      font-size: 14px;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.7);
    }

    .status-message.error {
      color: #FF6B6B;
    }

    .status-message.success {
      color: #4ECDC4;
    }

    /* Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 60px;
    }

    .page-btn {
      padding: 10px 14px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.7);
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .page-btn:hover {
      background: rgba(255, 107, 107, 0.2);
      border-color: #FF6B6B;
      color: #FFFFFF;
    }

    .page-btn:disabled {
      opacity: 0.35;
      cursor: not-allowed;
      border-color: rgba(255, 255, 255, 0.1);
    }

    .page-btn.active {
      background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
      border-color: #FF6B6B;
      color: #FFFFFF;
    }

    .prev-btn,
    .next-btn {
      padding: 10px 12px;
    }

    /* Page container */
    .page {
      display: none;
    }

    .page.active {
      display: grid;
      grid-template-columns: repeat(1, minmax(0, 1fr));
      gap: 24px;
    }

    @media (min-width: 640px) {
      .page.active {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (min-width: 1024px) {
      .page.active {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    @media (min-width: 1280px) {
      .page.active {
        grid-template-columns: repeat(4, minmax(0, 1fr));
      }
    }

    /* Photo Modal */
    #photoModal {
      background: rgba(10, 14, 39, 0.98);
      display: flex;
      justify-content: center;
      align-items: center;
      position: fixed;
      inset: 0;
      z-index: 200;
      padding: 24px;
      overflow-y: auto;
    }

    #photoModal.hidden {
      display: none;
    }

    #photoModal .modal-content {
      display: flex;
      max-width: 900px;
      width: 100%;
      background: rgba(26, 11, 46, 0.95);
      border-radius: 24px;
      overflow: hidden;
      border: 2px solid rgba(255, 107, 107, 0.3);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
      max-height: 90vh;
      position: relative;
    }

    #photoModal .modal-image-section {
      flex: 2;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      min-width: 500px;
      min-height: 600px;
      position: relative;
    }

    #photoModal .modal-header {
      padding: 0 0 20px 0;
      border-bottom: 2px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    #photoModal .modal-header-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 100%);
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
      color: white;
    }

    #photoModal .modal-header-info h3 {
      font-size: 16px;
      font-weight: 700;
      color: #FFFFFF;
      margin: 0;
    }

    #photoModal .modal-header-info p {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.5);
      margin: 0;
    }

    #photoModal .modal-image-section img {
      max-width: 100%;
      max-height: 550px;
      width: auto;
      height: auto;
      object-fit: contain;
      border-radius: 12px;
    }

    #photoModal .modal-info-section {
      flex: 1;
      padding: 32px;
      overflow-y: auto;
      max-height: 90vh;
      color: #FFFFFF;
    }

    #photoModal .modal-description {
      font-size: 15px;
      color: rgba(255, 255, 255, 0.9);
      line-height: 1.6;
      margin-bottom: 16px;
    }

    #photoModal .modal-info-section .modal-description {
      margin-top: 0;
    }

    #photoModal .modal-date {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.6);
      font-weight: 600;
      letter-spacing: 0.03em;
    }

    #photoModal .close-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 32px;
      background: none;
      border: none;
      cursor: pointer;
      color: #fff;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      z-index: 10;
      font-weight: 400;
      line-height: 0;
      padding: 0;
    }

    #photoModal .close-btn:hover {
      color: #FF6B6B;
      transform: scale(1.1);
    }

    .modal-nav-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 48px;
      height: 48px;
      background: none;
      border: none;
      color: white;
      font-size: 32px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      z-index: 10;
      opacity: 0;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
    }

    .modal-image-section:hover .modal-nav-btn:not(:disabled) {
      opacity: 1;
    }

    .modal-nav-btn:hover:not(:disabled) {
      transform: translateY(-50%) scale(1.2);
    }

    .modal-nav-btn:disabled {
      opacity: 0 !important;
      cursor: not-allowed;
    }

    .modal-nav-btn.prev {
      left: 20px;
    }

    .modal-nav-btn.next {
      right: 20px;
    }

    /* Utility classes */
    .flex {
      display: flex;
    }

    .items-center {
      align-items: center;
    }

    .gap-2 {
      gap: 8px;
    }

    .gap-6 {
      gap: 24px;
    }

    .text-center {
      text-align: center;
    }

    .grid {
      display: grid;
    }

    .grid-cols-1 {
      grid-template-columns: repeat(1, minmax(0, 1fr));
    }

    .gap-6 {
      gap: 24px;
    }

    @media (min-width: 640px) {
      .sm-grid-cols-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (min-width: 1024px) {
      .lg-grid-cols-3 {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    @media (min-width: 1280px) {
      .xl-grid-cols-4 {
        grid-template-columns: repeat(4, minmax(0, 1fr));
      }
    }

    @media (max-width: 640px) {
      #photoModal .modal-content {
        flex-direction: column;
      }

      #photoModal .modal-image-section {
        min-width: auto;
        min-height: 400px;
      }
    }
  </style>
</head>

<body>
  <!-- Navigation -->
  <nav id="mainNav">
    <div class="logo">
      <span class="logo-text">KLIKSY</span><span class="logo-dot">.</span>
    </div>
    <div class="nav-links flex gap-2">
      <a href="feed.html" class="nav-link active">Feed</a>
      <a href="upload.html" class="nav-link">Upload</a>
      <a href="profile.html" class="nav-link">Profile</a>
    </div>
  </nav>

  <main>
    <h1 class="feed-hero">Where Memes Live</h1>
    <p class="subtitle">ðŸ”¥ The Internet's Funniest Moments, All In One Place ðŸ”¥</p>

    <div id="feedStatus" class="status-message" role="status" aria-live="polite"></div>

    <div id="feedGrid" class="page active" data-page="dynamic" aria-live="polite"></div>

    <!-- Pagination -->
    <div id="paginationControls" class="pagination" aria-label="Feed pagination"></div>
  </main>

  <!-- Photo Modal -->
  <div id="photoModal" class="hidden">
    <button class="close-btn">&times;</button>
    <div class="modal-content">
      <!-- Image Section -->
      <div class="modal-image-section">
        <button class="modal-nav-btn prev" type="button" id="modalPrevBtn">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button class="modal-nav-btn next" type="button" id="modalNextBtn">
          <i class="fas fa-chevron-right"></i>
        </button>
        <img id="modalImage" src="" alt="">
      </div>
      
      <!-- Info Section -->
      <div class="modal-info-section">
        <div class="modal-header">
          <div class="modal-header-avatar" id="modalHeaderAvatar"></div>
          <div class="modal-header-info">
            <h3 id="modalHeaderUsername"></h3>
            <p id="modalHeaderTimestamp"></p>
          </div>
        </div>
        <p class="modal-description" id="modalDescription"></p>
        <p class="modal-date" id="modalPosted"></p>
      </div>
    </div>
  </div>

  <script>
    const FEED_ENDPOINT = 'https://hoev7s4i82.execute-api.us-east-1.amazonaws.com/load-feed';
    const PAGE_SIZE = 8;
    const PLACEHOLDER_IMAGE = 'https://via.placeholder.com/800x800/140a28/FFFFFF?text=KLIKSY';

    let currentPage = 1;
    let totalPages = 1;
    let isLoadingFeed = false;
    let currentModalIndex = -1;
    let allMemeCards = [];

    const feedGrid = document.getElementById('feedGrid');
    const paginationContainer = document.getElementById('paginationControls');
    const feedStatus = document.getElementById('feedStatus');

    const gradientPalette = [
      'linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%)',
      'linear-gradient(135deg, #4ECDC4 0%, #45B7AF 100%)',
      'linear-gradient(135deg, #FFE66D 0%, #FFB347 100%)',
      'linear-gradient(135deg, #6C63FF 0%, #7EE8FA 100%)',
      'linear-gradient(135deg, #FF9A9E 0%, #FAD0C4 100%)',
    ];

    const CDN_BASE_URL = (window.KliksyConfig?.cdnBaseUrl || '').replace(/\/$/, '');

    const setFeedStatus = (message = '', type = '') => {
      feedStatus.textContent = message;
      feedStatus.classList.remove('error', 'success');
      if (type) {
        feedStatus.classList.add(type);
      }
      feedStatus.style.display = message ? 'block' : 'none';
    };

    const pickGradient = (seed = '') => {
      if (!seed) return gradientPalette[0];
      const hash = seed.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
      return gradientPalette[hash % gradientPalette.length];
    };

    const normalizeToUTCString = (value) => {
      if (!value || typeof value !== 'string') return value;
      if (value.endsWith('Z') || value.includes('+')) {
        return value;
      }
      return `${value}Z`;
    };

    const formatPhilippineDate = (input) => {
      const normalized = typeof input === 'string' ? normalizeToUTCString(input) : input;
      const date = normalized ? new Date(normalized) : new Date();
      if (Number.isNaN(date.getTime())) {
        return 'Date unavailable';
      }
      return new Intl.DateTimeFormat('en-PH', {
        timeZone: 'Asia/Manila',
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      }).format(date);
    };

    const resolveImageUrl = (meme) => {
      const key = meme?.s3Key || meme?.s3_key;
      if (meme?.fileUrl) return meme.fileUrl;
      if (meme?.imageUrl) return meme.imageUrl;
      if (meme?.s3Url) return meme.s3Url;
      if (meme?.bucket && key) return `https://${meme.bucket}.s3.amazonaws.com/${key}`;
      if (CDN_BASE_URL && key) return `${CDN_BASE_URL}/${key}`;
      return PLACEHOLDER_IMAGE;
    };

    const buildUsername = (meme) => {
      if (meme?.username) return meme.username;
      if (meme?.user?.username) return meme.user.username;
      if (meme?.displayName) return meme.displayName;
      if (meme?.email) return meme.email.split('@')[0];
      if (meme?.user?.email) return meme.user.email.split('@')[0];
      return 'Kliksy User';
    };

    const avatarInitials = (name = '') => name.trim().slice(0, 2).toUpperCase() || 'K';

    const createMemeCard = (meme) => {
      const card = document.createElement('div');
      card.className = 'meme-card';

      const image = document.createElement('img');
      image.src = resolveImageUrl(meme);
      image.alt = meme?.description || 'Kliksy meme';
      card.appendChild(image);

      const info = document.createElement('div');
      info.className = 'info';

      const userRow = document.createElement('div');
      userRow.className = 'user';

      const username = buildUsername(meme);
      const avatar = document.createElement('div');
      avatar.className = 'avatar';
      avatar.textContent = avatarInitials(username);
      const avatarBg = pickGradient(username + (meme?.userId || ''));
      avatar.style.background = avatarBg;
      avatar.dataset.gradient = avatarBg;
      userRow.appendChild(avatar);

      const usernameSpan = document.createElement('span');
      usernameSpan.textContent = username;
      userRow.appendChild(usernameSpan);
      info.appendChild(userRow);

      const description = document.createElement('p');
      description.className = 'description';
      description.textContent = meme?.description || 'Shared a fresh meme.';
      info.appendChild(description);

      const metaRow = document.createElement('div');
      metaRow.className = 'meta-row';

      const timestamp = document.createElement('span');
      timestamp.className = 'timestamp';
      const createdAt = meme?.createdAt || meme?.created_at || meme?.createdOn || meme?.updatedAt;
      const normalizedTimestamp = normalizeToUTCString(createdAt) || new Date().toISOString();
      timestamp.textContent = formatPhilippineDate(normalizedTimestamp);
      timestamp.dataset.timestamp = normalizedTimestamp;
      metaRow.appendChild(timestamp);

      info.appendChild(metaRow);
      card.appendChild(info);

      return card;
    };

    const renderMemes = (memes) => {
      feedGrid.innerHTML = '';
      if (!memes.length) {
        setFeedStatus('No memes yet. Be the first to upload one!', '');
        allMemeCards = [];
        return;
      }
      setFeedStatus('');
      const fragment = document.createDocumentFragment();
      memes.forEach((meme) => fragment.appendChild(createMemeCard(meme)));
      feedGrid.appendChild(fragment);
      allMemeCards = Array.from(feedGrid.querySelectorAll('.meme-card'));
      attachCardListeners();
    };

    const renderPagination = () => {
      paginationContainer.innerHTML = '';
      if (totalPages <= 1) {
        paginationContainer.style.display = 'none';
        return;
      }
      paginationContainer.style.display = 'flex';

      const createButton = (label, targetPage, extraClass = '', disabled = false, isActive = false) => {
        const button = document.createElement('button');
        button.className = `page-btn ${extraClass}`.trim();
        button.innerHTML = label;
        button.disabled = disabled;
        if (isActive) {
          button.classList.add('active');
        }
        button.addEventListener('click', () => {
          if (disabled || targetPage === currentPage) return;
          loadPage(targetPage);
        });
        return button;
      };

      paginationContainer.appendChild(
        createButton('<i class="fas fa-chevron-left"></i>', Math.max(1, currentPage - 1), 'prev-btn', currentPage === 1)
      );

      for (let page = 1; page <= totalPages; page += 1) {
        paginationContainer.appendChild(
          createButton(String(page), page, '', false, page === currentPage)
        );
      }

      paginationContainer.appendChild(
        createButton('<i class="fas fa-chevron-right"></i>', Math.min(totalPages, currentPage + 1), 'next-btn', currentPage === totalPages)
      );
    };

    const parseFeedPayload = (payload, fallbackPage) => {
      const memes = payload?.items || payload?.memes || [];
      const total = payload?.total || payload?.count || payload?.pagination?.totalItems;
      const pageSize = payload?.pageSize || payload?.pagination?.pageSize || PAGE_SIZE;
      const derivedTotalPages = payload?.totalPages
        || payload?.pagination?.totalPages
        || (total ? Math.max(1, Math.ceil(total / pageSize)) : Math.max(1, Math.ceil(memes.length / pageSize)));
      const page = payload?.page || payload?.pagination?.page || fallbackPage;

      return {
        memes,
        totalPages: derivedTotalPages,
        page,
      };
    };

    const loadPage = async (page = 1) => {
      if (isLoadingFeed) return;
      isLoadingFeed = true;
      setFeedStatus('Loading feedâ€¦');
      try {
        const url = new URL(FEED_ENDPOINT, window.location.origin);
        url.searchParams.set('page', page);
        url.searchParams.set('pageSize', PAGE_SIZE);
        const viewer = window.kliksyAuth?.user?.email || window.kliksyAuth?.user?.username;
        if (viewer) {
          url.searchParams.set('viewer', viewer);
        }

        const response = await fetch(url.toString(), {
          headers: {
            'Content-Type': 'application/json',
          },
        });

        if (!response.ok) {
          throw new Error('Unable to load feed right now.');
        }

        const payload = await response.json().catch(() => ({}));
        const parsed = parseFeedPayload(payload, page);
        currentPage = parsed.page;
        totalPages = parsed.totalPages;

        renderMemes(parsed.memes);
        renderPagination();
        if (parsed.memes.length) {
          window.scrollTo({ top: 0, behavior: 'auto' });
        }
      } catch (error) {
        console.error('Feed error:', error);
        setFeedStatus(error.message || 'Something went wrong while loading the feed.', 'error');
      } finally {
        isLoadingFeed = false;
      }
    };

    loadPage(1);

    // Photo modal functionality
    const photoModal = document.getElementById('photoModal');
    const modalImage = document.getElementById('modalImage');
    const modalHeaderUsername = document.getElementById('modalHeaderUsername');
    const modalHeaderAvatar = document.getElementById('modalHeaderAvatar');
    const modalHeaderTimestamp = document.getElementById('modalHeaderTimestamp');
    const modalDescription = document.getElementById('modalDescription');
    const modalPosted = document.getElementById('modalPosted');
    const closeModal = photoModal.querySelector('.close-btn');
    const modalPrevBtn = document.getElementById('modalPrevBtn');
    const modalNextBtn = document.getElementById('modalNextBtn');

    function updateModalContent(card) {
      const img = card.querySelector('img');
      const user = card.querySelector('.user span');
      const avatar = card.querySelector('.avatar');
      const desc = card.querySelector('.description');
      const time = card.querySelector('.timestamp');

      modalImage.src = img.src;
      modalImage.alt = img.alt;
      modalHeaderUsername.textContent = user.textContent;
      modalHeaderAvatar.textContent = avatar.textContent;
      modalHeaderAvatar.style.background = avatar.style.background || 'linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 100%)';
      modalHeaderTimestamp.textContent = time.textContent;
      modalDescription.textContent = desc.textContent;
      const originalTimestamp = time?.dataset.timestamp || time?.textContent;
      modalPosted.textContent = originalTimestamp
        ? formatPhilippineDate(originalTimestamp)
        : '';
    }

    function updateNavigationButtons() {
      if (modalPrevBtn && modalNextBtn) {
        modalPrevBtn.disabled = currentModalIndex <= 0;
        modalNextBtn.disabled = currentModalIndex >= allMemeCards.length - 1;
      }
    }

    function navigateModal(direction) {
      const newIndex = currentModalIndex + direction;
      if (newIndex >= 0 && newIndex < allMemeCards.length) {
        currentModalIndex = newIndex;
        updateModalContent(allMemeCards[currentModalIndex]);
        updateNavigationButtons();
      }
    }

    function attachCardListeners() {
      document.querySelectorAll('.meme-card').forEach((card, index) => {
        card.addEventListener('click', () => {
          currentModalIndex = index;
          updateModalContent(card);
          updateNavigationButtons();
          photoModal.classList.remove('hidden');
          document.body.style.overflow = 'hidden';
        });
      });
    }

    closeModal.addEventListener('click', () => {
      photoModal.classList.add('hidden');
      document.body.style.overflow = 'auto';
      currentModalIndex = -1;
    });

    if (modalPrevBtn) {
      modalPrevBtn.addEventListener('click', () => navigateModal(-1));
    }

    if (modalNextBtn) {
      modalNextBtn.addEventListener('click', () => navigateModal(1));
    }

    photoModal.addEventListener('click', e => {
      if (e.target === photoModal) {
        photoModal.classList.add('hidden');
        document.body.style.overflow = 'auto';
        currentModalIndex = -1;
      }
    });

    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') {
        photoModal.classList.add('hidden');
        document.body.style.overflow = 'auto';
        currentModalIndex = -1;
      }
    });

    // Initialize modal listeners once
    attachCardListeners();
  </script>

</body>

</html>